# -*- mode: ruby -*-
# vi: set ft=ruby :

# Set memory value (MB) and number of CPU cores here
$MEMORY = "2048"
$CPU = "2"

# Inline shell script for provisioning CentOS 7
$centos_script = <<SCRIPT
# Add EPEL repo for access to Puppet, git-review, etc.
sudo yum install -y epel-release

# Install other packages (must be done after EPEL repo add)
sudo yum install -y \
  puppet \
  git \
  git-review \
  vim \
  nano
SCRIPT

# Initial Vagrant configuration
Vagrant.configure(2) do |config|

  # --------------------------------
  # Shared VirtualBox configuration
  # --------------------------------
  config.vm.provider "virtualbox" do |vb|
    # Set RAM in MB
    vb.memory = $MEMORY
    # Set num CPU cores
    vb.cpus = $CPU
  end

  # --------------------------
  # Configuration for CentOS 7
  # --------------------------
  config.vm.define "centos" do |centos|
    # Build Vagrant box based on CentOS 7
    centos.vm.box = "chef/centos-7.0"
    # Set hostname of box
    centos.vm.hostname = "tools-centos"
    # Enable X11 SSH forwarding for GUI applications
    config.ssh.forward_x11 = "true"

    # Use shell provisioner to install additional packages
    centos.vm.provision "shell" do |shell|
      # Inline shell provisioning
      shell.inline = $centos_script
    end

    # Install OpenDaylight using its Puppet module
    centos.vm.provision "puppet" do |puppet|
      puppet.module_path = ["modules"]
      puppet.manifest_file = "odl_install.pp"
    end

    # VirtualBox configuration specific to this box
    centos.vm.provider "virtualbox" do |vb|
      # Name of VirtualBox guest machine
      vb.name = "Integration Tools: CentOS-7"
    end
  end

  # ----------------------------------
  # Configuration for Ubuntu 14.04 LTS
  # ----------------------------------
  config.vm.define "ubuntu" do |ubuntu|
    # Build Vagrant box based on Ubuntu 14.04
    ubuntu.vm.box = "ubuntu/trusty64"
    # Set hostname of box
    ubuntu.vm.hostname = "tools-ubuntu"
    # Enable X11 SSH forwarding for GUI applications
    config.ssh.forward_x11 = "true"
    # VirtualBox configuration specific to this box
    ubuntu.vm.provider "virtualbox" do |vb|
      # Name of VirtualBox guest machine
      vb.name = "Integration Tools: Ubuntu-14.04"
    end
  end
end
